{"version":3,"sources":["../../src/crypto/interface.ts","../../src/crypto/web.ts"],"names":[],"mappings":"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","file":"web.cjs","sourcesContent":["/**\n * @file crypto/interface.ts\n * @description Unified crypto provider interface.\n * Implementations: node.ts (Node/Bun/Deno), web.ts (Browser/React Native).\n *\n * Copyright (c) 2026 Hestia Labs\n * SDK-License-Identifier: MIT\n */\n\nexport interface CryptoProvider {\n    /**\n     * Compute HMAC-SHA256 and return lowercase hex string (64 chars).\n     * @param secret - Raw secret bytes.\n     * @param data - UTF-8 string to sign.\n     */\n    signHmacSha256(secret: Uint8Array, data: string): Promise<string>;\n\n    /**\n     * Compute SHA-256 hash and return lowercase hex string (64 chars).\n     * @param data - UTF-8 string to hash.\n     */\n    sha256Hex(data: string): Promise<string>;\n\n    /**\n     * Generate cryptographically secure random bytes.\n     * @param length - Number of bytes.\n     */\n    randomBytes(length: number): Uint8Array;\n}\n\n/**\n * Constant-time string comparison.\n * Safe for comparing HMAC hex digests â€” prevents timing side-channels.\n * Platform-independent: does NOT rely on crypto.timingSafeEqual.\n */\nexport function constantTimeEqual(a: string, b: string): boolean {\n    if (a.length !== b.length) return false;\n\n    let diff = 0;\n    for (let i = 0; i < a.length; i++) {\n        diff |= a.charCodeAt(i) ^ b.charCodeAt(i);\n    }\n    return diff === 0;\n}\n\n/** Convert Uint8Array to lowercase hex string. */\nexport function bytesToHex(bytes: Uint8Array): string {\n    const hex: string[] = [];\n    for (let i = 0; i < bytes.length; i++) {\n        hex.push((bytes[i]! >>> 4).toString(16));\n        hex.push((bytes[i]! & 0x0f).toString(16));\n    }\n    return hex.join(\"\");\n}\n\n/** Convert hex string to Uint8Array. */\nexport function hexToBytes(hex: string): Uint8Array {\n    if (hex.length % 2 !== 0) {\n        throw new Error(\"Invalid hex string length\");\n    }\n    const bytes = new Uint8Array(hex.length / 2);\n    for (let i = 0; i < hex.length; i += 2) {\n        bytes[i / 2] = parseInt(hex.substring(i, i + 2), 16);\n    }\n    return bytes;\n}\n","/**\n * @file crypto/web.ts\n * @description Browser / React Native crypto provider using Web Crypto API.\n * Works in all environments with `crypto.subtle` (browsers, Expo, Deno).\n *\n * Copyright (c) 2026 Hestia Labs\n * SDK-License-Identifier: MIT\n */\n\nimport type { CryptoProvider } from \"./interface.js\";\nimport { bytesToHex } from \"./interface.js\";\n\nexport { constantTimeEqual, hexToBytes, bytesToHex } from \"./interface.js\";\n\n/** Resolve the global crypto object across environments. */\nfunction getSubtle(): SubtleCrypto {\n    if (typeof globalThis.crypto?.subtle !== \"undefined\") {\n        return globalThis.crypto.subtle;\n    }\n    throw new Error(\"Web Crypto API not available. Use hxtp-js/crypto/node for Node.js.\");\n}\n\n/** Resolve the global crypto for randomness. */\nfunction getCrypto(): Crypto {\n    if (typeof globalThis.crypto !== \"undefined\") {\n        return globalThis.crypto;\n    }\n    throw new Error(\"crypto.getRandomValues not available in this environment.\");\n}\n\nconst encoder = new TextEncoder();\n\nclass WebCryptoProvider implements CryptoProvider {\n    async signHmacSha256(secret: Uint8Array, data: string): Promise<string> {\n        const subtle = getSubtle();\n        const key = await subtle.importKey(\n            \"raw\",\n            secret.buffer as ArrayBuffer,\n            { name: \"HMAC\", hash: \"SHA-256\" },\n            false,\n            [\"sign\"],\n        );\n        const sig = await subtle.sign(\"HMAC\", key, encoder.encode(data));\n        return bytesToHex(new Uint8Array(sig));\n    }\n\n    async sha256Hex(data: string): Promise<string> {\n        const subtle = getSubtle();\n        const digest = await subtle.digest(\"SHA-256\", encoder.encode(data));\n        return bytesToHex(new Uint8Array(digest));\n    }\n\n    randomBytes(length: number): Uint8Array {\n        const buf = new Uint8Array(length);\n        getCrypto().getRandomValues(buf);\n        return buf;\n    }\n}\n\n/** Singleton Web Crypto provider. */\nexport const webCrypto: CryptoProvider = new WebCryptoProvider();\n\n/**\n * Generate a nonce as hex string using Web Crypto.\n */\nexport function generateNonce(byteLength: number = 16): string {\n    const bytes = new Uint8Array(byteLength);\n    getCrypto().getRandomValues(bytes);\n    return bytesToHex(bytes);\n}\n"]}